schema: '2.0'
stages:
  fetch:
    cmd: poetry run python src/data/fetch_data.py
    deps:
    - path: src/data/fetch_data.py
      hash: md5
      md5: 2e9355f089af089c835847307928bcb3
      size: 6571
    outs:
    - path: data/raw
      hash: md5
      md5: e8b015e2dd65b9ff2c5ed0d7ddc9f7c8.dir
      size: 379300
      nfiles: 69
  preprocess:
    cmd: poetry run python src/data/preprocess_data.py
    deps:
    - path: data/raw
      hash: md5
      md5: e8b015e2dd65b9ff2c5ed0d7ddc9f7c8.dir
      size: 379300
      nfiles: 69
    - path: src/data/preprocess_data.py
      hash: md5
      md5: 3188413722c42422eb9e08c424999a5d
      size: 5396
    outs:
    - path: data/processed/combined
      hash: md5
      md5: 2f7ecd7dcac05fad9910f5a31e35587a.dir
      size: 2228222
      nfiles: 34
    - path: data/processed/mbajk
      hash: md5
      md5: 31efcc24ac77984d9f2b4c685de878e0.dir
      size: 43645
      nfiles: 34
    - path: data/processed/weather
      hash: md5
      md5: 9acf2aaec55b9d80c42bb48138a62a92.dir
      size: 243386
      nfiles: 34
  split:
    cmd: poetry run python src/data/final_processing.py
    deps:
    - path: data/processed/combined
      hash: md5
      md5: 8abef20d8b67a381ef70e9f13162de84.dir
      size: 2225814
      nfiles: 34
    - path: src/data/final_processing.py
      hash: md5
      md5: a6f312adc6982afb88ab0126cc06c9b5
      size: 1434
    outs:
    - path: data/processed/test
      hash: md5
      md5: 3948e48095f6756ea2be3791be19200f.dir
      size: 225366
      nfiles: 34
    - path: data/processed/train
      hash: md5
      md5: 6847305dc5e0dd20a1bd57bfb139c2bc.dir
      size: 2005208
      nfiles: 34
  reference_data:
    cmd: "mkdir -p data/processed\ncp -r data/processed/combined data/processed/reference_data\n
      cp -r data/processed/combined data/processed/current_data\n"
    deps:
    - path: data/processed/combined
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    outs:
    - path: data/processed/current_data
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    - path: data/processed/reference_data
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
  validate_and_test:
    cmd: "poetry run python src/data/validate_and_test_unified.py --reference data/processed/reference_data
      --current data/processed/current_data --suite_name \"mbajk_suite\"\npoetry run
      python src/data/validate_and_test_unified.py --reference data/processed/merged/reference_data.csv
      --current data/processed/merged/current_data.csv --suite_name \"mbajk_merged_suite\"\
      \n"
    deps:
    - path: data/processed/current_data
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    - path: data/processed/merged/current_data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
    - path: data/processed/merged/reference_data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
    - path: data/processed/reference_data
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    - path: src/data/validate_and_test_unified.py
      hash: md5
      md5: 6e7db64fd2649013b833313310abde42
      size: 5598
  split_data:
    cmd: "poetry run python src/data/split_data_unified.py --input data/processed/current_data
      --output_train data/processed/train_test_from_current/train --output_test data/processed/train_test_from_current/test\n
      poetry run python src/data/split_data_unified.py --input data/processed/merged/data.csv
      --output_train data/processed/train_test_merged/train.csv --output_test data/processed/train_test_merged/test.csv\n"
    deps:
    - path: data/processed/merged/data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
    - path: src/data/split_data_unified.py
      hash: md5
      md5: 07b40675fd52d33fdc804455a0b178b3
      size: 2296
    outs:
    - path: data/processed/train_test_from_current/test
      hash: md5
      md5: db2563542f941a3eabfb641f7b0cc61f.dir
      size: 252534
      nfiles: 34
    - path: data/processed/train_test_from_current/train
      hash: md5
      md5: 6c55abbcaaf77937fb9c741cea08f73f.dir
      size: 2223125
      nfiles: 34
    - path: data/processed/train_test_merged/test.csv
      hash: md5
      md5: 9cb99f3b139fab4c9a28f1d42ad8275e
      size: 250181
    - path: data/processed/train_test_merged/train.csv
      hash: md5
      md5: 2f25d08f4136380a490cea619eb95594
      size: 2216238
  train_model_mlflow:
    cmd: poetry run python src/models/train_model_mlflow.py
    deps:
    - path: data/processed/train_test_from_current/train
      hash: md5
      md5: 93a374efe317effad76e12e9d541c1b8.dir
      size: 2003720
      nfiles: 34
    - path: src/models/train_model_mlflow.py
      hash: md5
      md5: 49743562aa8296aacd33ad1f1bda96ab
      size: 3974
    outs:
    - path: models/models_mlflow
      hash: md5
      md5: 87f2056c89c5f9f5d191723c94881e20.dir
      size: 6608215
      nfiles: 189
  predict_model_mlflow:
    cmd: poetry run python src/models/predict_model_mlflow.py
    deps:
    - path: data/processed/train_test_from_current/test
      hash: md5
      md5: 2b5f1ccad1478fe9108bba0ed639db86.dir
      size: 229262
      nfiles: 34
    - path: models/models_mlflow
      hash: md5
      md5: 87f2056c89c5f9f5d191723c94881e20.dir
      size: 6608215
      nfiles: 189
    - path: models/models_mlflow_full
      hash: md5
      md5: 095f1b56521ccbd5b2f6cc4a86c5bd8e.dir
      size: 206850
      nfiles: 1
    - path: models/models_mlflow_merged
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
    - path: src/models/predict_model_mlflow.py
      hash: md5
      md5: 23ea9e7d983d9d263ec0d66e3958ba50
      size: 2065
  merge_data:
    cmd: poetry run python src/data/merge_data.py
    deps:
    - path: data/processed/combined
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    - path: src/data/merge_data.py
      hash: md5
      md5: 38afd2c3c3eec28699525e5cdc47106d
      size: 797
    outs:
    - path: data/processed/merged/data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
  reference_data_merged:
    cmd: "cp data/processed/merged/data.csv data/processed/merged/reference_data.csv\n
      cp data/processed/merged/data.csv data/processed/merged/current_data.csv\n"
    deps:
    - path: data/processed/merged/data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
    outs:
    - path: data/processed/merged/current_data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
    - path: data/processed/merged/reference_data.csv
      hash: md5
      md5: e344d633656e259dbee64c160054280c
      size: 2466279
  validate_and_test_merged:
    cmd: poetry run python src/data/validate_and_test_merged.py
    deps:
    - path: data/processed/merged/current_data.csv
      hash: md5
      md5: 33effdeaa89cdf2caa7f3ee04f88463d
      size: 2223602
    - path: data/processed/merged/reference_data.csv
      hash: md5
      md5: 33effdeaa89cdf2caa7f3ee04f88463d
      size: 2223602
    - path: src/data/validate_and_test_merged.py
      hash: md5
      md5: 044597704d888f512d8ac109222602bf
      size: 4657
  split_data_merged:
    cmd: poetry run python src/data/split_merged_data.py
    deps:
    - path: data/processed/merged/current_data.csv
      hash: md5
      md5: 33effdeaa89cdf2caa7f3ee04f88463d
      size: 2223602
    - path: src/data/split_merged_data.py
      hash: md5
      md5: 29991beb32dceefcc8d0285c9a6938cf
      size: 888
    outs:
    - path: data/processed/train_test_merged/test.csv
      hash: md5
      md5: 1313cb2fe0914d119ebefc400e865611
      size: 222651
    - path: data/processed/train_test_merged/train.csv
      hash: md5
      md5: 5056a8de671f2bbb6487a14b2efad30a
      size: 2001091
  train_model_mlflow_merged:
    cmd: poetry run python src/models/train_merged_model_mlflow.py
    deps:
    - path: data/processed/train_test_merged/train.csv
      hash: md5
      md5: 0558d00c33c31952b2b2aaf5cacd32bd
      size: 1902948
    - path: src/models/train_merged_model_mlflow.py
      hash: md5
      md5: 2acaec863c6bd705395e98d201bf6c94
      size: 2016
    outs:
    - path: models/models_mlflow_merged
      hash: md5
      md5: fb39149a4607f0ec33938a249fbe1c80.dir
      size: 206806
      nfiles: 1
  predict_model_mlflow_merged:
    cmd: poetry run python src/models/predict_merged_model_mlflow.py
    deps:
    - path: data/processed/train_test_merged/test.csv
      hash: md5
      md5: f1d283c91624220a6e5f755ca84e24fd
      size: 211239
    - path: models/models_mlflow_merged
      hash: md5
      md5: fb39149a4607f0ec33938a249fbe1c80.dir
      size: 206806
      nfiles: 1
    - path: src/models/predict_merged_model_mlflow.py
      hash: md5
      md5: 65ff6395357acebb6c8eb95fb8bac4cc
      size: 1481
  train_model_full_mlflow:
    cmd: poetry run python src/models/train_full_model_mlflow.py
    deps:
    - path: data/processed/train_test_merged/test.csv
      hash: md5
      md5: 1313cb2fe0914d119ebefc400e865611
      size: 222651
    - path: data/processed/train_test_merged/train.csv
      hash: md5
      md5: 5056a8de671f2bbb6487a14b2efad30a
      size: 2001091
    - path: src/models/train_full_model_mlflow.py
      hash: md5
      md5: 9c8f4ead2d9eba057cc48544991c887c
      size: 3953
    outs:
    - path: models/models_mlflow_full
      hash: md5
      md5: 095f1b56521ccbd5b2f6cc4a86c5bd8e.dir
      size: 206850
      nfiles: 1
  evaluate_and_register:
    cmd: "poetry run python src/models/evaluate_and_register_models.py --model_type
      station\npoetry run python src/models/evaluate_and_register_models.py --model_type
      merged\n"
    deps:
    - path: models/models_mlflow
      hash: md5
      md5: 87f2056c89c5f9f5d191723c94881e20.dir
      size: 6608215
      nfiles: 189
    - path: models/models_mlflow_merged
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
    - path: src/models/evaluate_and_register_models.py
      hash: md5
      md5: 0330c027c3bcde4c8102b98e4b689863
      size: 4454
  final_processing:
    cmd: poetry run python src/data/final_processing.py
    deps:
    - path: data/processed/combined
      hash: md5
      md5: 2f7ecd7dcac05fad9910f5a31e35587a.dir
      size: 2228222
      nfiles: 34
    - path: src/data/final_processing.py
      hash: md5
      md5: a6f312adc6982afb88ab0126cc06c9b5
      size: 1434
    outs:
    - path: data/processed/test
      hash: md5
      md5: 38887d26a918a5ceaf4b439abab31432.dir
      size: 225362
      nfiles: 34
    - path: data/processed/train
      hash: md5
      md5: e0554023432cd0aa47784bc147593ad9.dir
      size: 2007620
      nfiles: 34
  fetch_data:
    cmd: poetry run python src/data/fetch_data.py
    deps:
    - path: src/data/fetch_data.py
      hash: md5
      md5: 2e9355f089af089c835847307928bcb3
      size: 6571
    outs:
    - path: data/raw
      hash: md5
      md5: aa74581e5a79163a3dcad13c969454ab.dir
      size: 1008343
      nfiles: 69
  preprocess_data:
    cmd: poetry run python src/data/preprocess_data.py
    deps:
    - path: data/raw
      hash: md5
      md5: aa74581e5a79163a3dcad13c969454ab.dir
      size: 1008343
      nfiles: 69
    - path: src/data/preprocess_data.py
      hash: md5
      md5: 3188413722c42422eb9e08c424999a5d
      size: 5396
    outs:
    - path: data/processed/combined
      hash: md5
      md5: 8cdd7eb2b5e336af615ed24e7c441b31.dir
      size: 2470899
      nfiles: 34
    - path: data/processed/mbajk
      hash: md5
      md5: 77d65930260533b9ca990c6d52181e0b.dir
      size: 208359
      nfiles: 34
    - path: data/processed/weather
      hash: md5
      md5: 20a741f90372f729ea238be0e16023be.dir
      size: 419539
      nfiles: 34
  train_model:
    cmd: "poetry run python src/models/train_model_unified.py --model_type station\n
      poetry run python src/models/train_model_unified.py --model_type merged\n"
    deps:
    - path: data/processed/train_test_from_current/train
      hash: md5
      md5: 6c55abbcaaf77937fb9c741cea08f73f.dir
      size: 2223125
      nfiles: 34
    - path: data/processed/train_test_merged/train.csv
      hash: md5
      md5: 2f25d08f4136380a490cea619eb95594
      size: 2216238
    - path: src/models/train_model_unified.py
      hash: md5
      md5: f211a80fb1b24db5f157fdf968c23827
      size: 4630
    outs:
    - path: models/models_mlflow
      hash: md5
      md5: 87f2056c89c5f9f5d191723c94881e20.dir
      size: 6608215
      nfiles: 189
    - path: models/models_mlflow_merged
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
  predict_model:
    cmd: poetry run python src/models/predict_model_unified.py --model_type merged
      --input_data data/processed/train_test_merged/test.csv --output data/predictions/merged_predictions.csv
    deps:
    - path: data/processed/train_test_merged/test.csv
      hash: md5
      md5: 9cb99f3b139fab4c9a28f1d42ad8275e
      size: 250181
    - path: models/models_mlflow_merged
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
    - path: src/models/predict_model_unified.py
      hash: md5
      md5: a924976ed63439dcdd67b5e1dc6920ef
      size: 3859
    outs:
    - path: data/predictions/merged_predictions.csv
      hash: md5
      md5: 7b2778241196873bbcbf1ba767e3c9f9
      size: 281052
  evaluate_predictions:
    cmd: "poetry run python src/models/evaluate_predictions.py --model_type station\n
      poetry run python src/models/evaluate_predictions.py --model_type merged\n"
    deps:
    - path: src/models/evaluate_predictions.py
      hash: md5
      md5: a34f811704f5d75a2776510e15b3ba5c
      size: 2669
